<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ESP32 Blockly Ultimate</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    <style>
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: 'Segoe UI', sans-serif; background: #f0f2f5; }
        .header { background: #2c3e50; color: white; padding: 10px 20px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #blocklyDiv { flex-grow: 1; width: 100%; }
        button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-flash { background: #27ae60; color: white; }
        .btn-flash:hover { background: #2ecc71; }
        .btn-code { background: #34495e; color: white; border: 1px solid #5d6d7e; }
        #codeModal { display: none; position: fixed; top: 10%; left: 10%; width: 80%; height: 80%; background: #1e1e1e; color: #d4d4d4; padding: 20px; z-index: 1000; border-radius: 8px; box-shadow: 0 0 30px rgba(0,0,0,0.5); overflow: auto; }
        pre { font-family: 'Consolas', monospace; font-size: 14px; line-height: 1.5; }
    </style>
</head>
<body>

<div class="header">
    <button id="btnFlash" class="btn-flash">‚ö° –ü–†–û–®–ò–¢–¨ ESP32</button>
    <button id="btnViewCode" class="btn-code">üìÑ –ü–û–°–ú–û–¢–†–ï–¢–¨ –ö–û–î</button>
    <div id="status">–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤</div>
</div>

<div id="blocklyDiv"></div>

<div id="codeModal">
    <h2 style="margin-top:0">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π C++ –∫–æ–¥:</h2>
    <pre id="codeOutput"></pre>
    <button onclick="document.getElementById('codeModal').style.display='none'" style="background:#e74c3c; color:white;">–ó–ê–ö–†–´–¢–¨</button>
</div>

<xml id="toolbox" style="display:none">
    <category name="–õ–æ–≥–∏–∫–∞" colour="210">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_boolean"></block>
    </category>
    <category name="–¶–∏–∫–ª—ã" colour="120">
        <block type="controls_repeat_ext"><value name="TIMES"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for"></block>
    </category>
    <category name="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" colour="230">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
        <block type="math_single"></block>
    </category>
    <category name="–¢–µ–∫—Å—Ç" colour="160">
        <block type="text"></block>
        <block type="text_join"></block>
    </category>
    <category name="–í—Ä–µ–º—è" colour="65">
        <block type="esp32_delay"></block>
        <block type="esp32_millis"></block>
    </category>
    <sep></sep>
    <category name="–í—Ö–æ–¥—ã / –í—ã—Ö–æ–¥—ã" colour="20">
        <block type="esp32_digital_write"></block>
        <block type="esp32_digital_read"></block>
        <block type="esp32_analog_read"></block>
        <block type="esp32_pwm_write"></block>
    </category>
    <category name="–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ" colour="0">
        <block type="esp32_interrupt"></block>
    </category>
    <category name="–ú–æ–Ω–∏—Ç–æ—Ä –ø–æ—Ä—Ç–∞" colour="160">
        <block type="esp32_serial_print"></block>
        <block type="esp32_serial_available"></block>
    </category>
    <category name="–ú–æ–¥—É–ª–∏ —Å–≤—è–∑–∏" colour="230">
        <block type="esp32_wifi_connect"></block>
        <block type="esp32_http_get"></block>
    </category>
    <category name="–°–µ–Ω—Å–æ—Ä—ã" colour="45">
        <block type="esp32_dht_read"></block>
        <block type="esp32_touch_read"></block>
        <block type="esp32_hall_read"></block>
    </category>
    <category name="–ú–æ—Ç–æ—Ä—ã" colour="190">
        <block type="esp32_servo_move"></block>
    </category>
    <category name="–î–∏—Å–ø–ª–µ–∏" colour="200">
        <block type="esp32_oled_init"></block>
        <block type="esp32_oled_print"></block>
        <block type="esp32_lcd_init"></block>
    </category>
    <category name="–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è" colour="260">
        <block type="esp32_spiffs_write"></block>
        <block type="esp32_spiffs_read"></block>
    </category>
    <sep></sep>
    <category name="–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ" colour="330" custom="VARIABLE"></category>
    <category name="–§—É–Ω–∫—Ü–∏–∏" colour="290" custom="PROCEDURE"></category>
</xml>

<script src="blocks.js"></script>
<script type="module" src="app.js"></script>
</body>
</html>
