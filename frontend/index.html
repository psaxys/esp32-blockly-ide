<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ESP32 Ultimate IDE</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    
    <style>
        body { 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            font-family: 'Segoe UI', sans-serif; 
            background: #f4f4f9; 
        }
        .header { 
            background: #2c3e50; 
            color: white; 
            padding: 10px 20px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        h1 { margin: 0; font-size: 18px; margin-right: auto; }
        #blocklyDiv { flex-grow: 1; width: 100%; }
        
        button { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 14px; 
            transition: background 0.2s; 
        }
        .btn-flash { background: #27ae60; color: white; }
        .btn-flash:hover { background: #2ecc71; }
        .btn-code { background: #34495e; color: white; border: 1px solid #7f8c8d; }
        .btn-code:hover { background: #4b6584; }
        #status { color: #ecf0f1; font-size: 14px; min-width: 150px; text-align: right;}

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–æ–¥–∞ */
        #codeModal { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.7); 
            z-index: 1000; 
            backdrop-filter: blur(2px);
        }
        .modal-content { 
            background: #1e1e1e; 
            color: #d4d4d4; 
            margin: 5% auto; 
            width: 80%; 
            height: 80%; 
            padding: 20px; 
            border-radius: 8px; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); 
        }
        #codeOutput { 
            flex-grow: 1; 
            overflow: auto; 
            font-family: 'Consolas', monospace; 
            white-space: pre-wrap; 
            background: #252526; 
            padding: 15px; 
            border: 1px solid #3e3e42;
        }
        .close-btn { 
            margin-top: 15px; 
            background: #c0392b; 
            color: white; 
            align-self: flex-end; 
        }
    </style>
</head>
<body>

<div class="header">
    <h1>ESP32 Visual Builder</h1>
    <button id="btnFlash" class="btn-flash">‚ö° –ü–†–û–®–ò–¢–¨ –£–°–¢–†–û–ô–°–¢–í–û</button>
    <button id="btnViewCode" class="btn-code">üìÑ –ü–û–°–ú–û–¢–†–ï–¢–¨ –ö–û–î</button>
    <div id="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
</div>

<div id="blocklyDiv"></div>

<div id="codeModal">
    <div class="modal-content">
        <h2 style="margin-top:0">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π C++ –∫–æ–¥</h2>
        <pre id="codeOutput"></pre>
        <button class="close-btn" onclick="document.getElementById('codeModal').style.display='none'">–ó–ê–ö–†–´–¢–¨</button>
    </div>
</div>

<xml id="toolbox" style="display:none">
    <category name="–õ–æ–≥–∏–∫–∞" colour="210">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
    </category>
    <category name="–¶–∏–∫–ª—ã" colour="120">
        <block type="controls_repeat_ext"><value name="TIMES"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_flow_statements"></block>
    </category>
    <category name="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" colour="230">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
        <block type="math_single"></block>
        <block type="math_random_int"></block>
    </category>
    <category name="–¢–µ–∫—Å—Ç" colour="160">
        <block type="text"></block>
        <block type="text_join"></block>
    </category>
    <category name="–í—Ä–µ–º—è" colour="65">
        <block type="esp32_delay"></block>
        <block type="esp32_millis"></block>
    </category>
    <sep></sep>
    <category name="–í—Ö–æ–¥—ã / –í—ã—Ö–æ–¥—ã" colour="20">
        <block type="esp32_digital_write"></block>
        <block type="esp32_digital_read"></block>
        <block type="esp32_analog_read"></block>
        <block type="esp32_pwm_write"></block>
    </category>
    <category name="–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è" colour="0">
        <block type="esp32_interrupt"></block>
    </category>
    <category name="–°–µ–Ω—Å–æ—Ä—ã" colour="45">
        <block type="esp32_dht_read"></block>
        <block type="esp32_touch_read"></block>
        <block type="esp32_hall_read"></block>
    </category>
    <category name="–ú–æ—Ç–æ—Ä—ã" colour="190">
        <block type="esp32_servo_move"></block>
    </category>
    <category name="–î–∏—Å–ø–ª–µ–∏ (OLED/LCD)" colour="200">
        <block type="esp32_oled_init"></block>
        <block type="esp32_oled_print"></block>
        <block type="esp32_lcd_init"></block>
    </category>
    <category name="–°–≤—è–∑—å (WiFi/Serial)" colour="230">
        <block type="esp32_serial_print"></block>
        <block type="esp32_wifi_connect"></block>
    </category>
    <category name="–•—Ä–∞–Ω–∏–ª–∏—â–µ" colour="260">
        <block type="esp32_spiffs_write"></block>
    </category>
    <sep></sep>
    <category name="–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ" colour="330" custom="VARIABLE"></category>
    <category name="–§—É–Ω–∫—Ü–∏–∏" colour="290" custom="PROCEDURE"></category>
</xml>

<script src="blocks.js"></script>
<script type="module" src="app.js"></script>

</body>
</html>
