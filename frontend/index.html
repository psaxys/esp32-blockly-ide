<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Blockly Programmer v2.0</title>
    
    <!-- Blockly 12.3.1 -->
    <script src="https://unpkg.com/blockly@12.3.1/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly@12.3.1/msg/ru.min.js"></script>
    <script src="https://unpkg.com/blockly@12.3.1/msg/en.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/blockly@12.3.1/blockly.min.css">
    
    <!-- Дополнительные библиотеки -->
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.5.0/dist/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.15.2/ace.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Иконка -->
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/espressif/esp-idf/master/docs/_static/espressif-logo.svg">
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-microchip"></i>
            <h1>ESP32 Blockly Programmer <span class="version">v2.0</span></h1>
        </div>
        <div class="nav-controls">
            <button class="btn btn-primary" onclick="saveProject()">
                <i class="fas fa-save"></i> Сохранить
            </button>
            <button class="btn btn-secondary" onclick="loadProjectModal()">
                <i class="fas fa-folder-open"></i> Загрузить
            </button>
            <button class="btn btn-success" onclick="generateCode()">
                <i class="fas fa-code"></i> Генерировать код
            </button>
            <button class="btn btn-warning" onclick="compileCode()">
                <i class="fas fa-cogs"></i> Компилировать
            </button>
            <button class="btn btn-danger" onclick="uploadToESP32()">
                <i class="fas fa-upload"></i> Загрузить на ESP32
            </button>
        </div>
    </nav>

    <!-- Основной контейнер -->
    <div class="container">
        <!-- Панель инструментов -->
        <div class="toolbar">
            <div class="toolbar-group">
                <span class="toolbar-label"><i class="fas fa-sliders-h"></i> Настройки:</span>
                <select id="boardSelect" class="select">
                    <option value="esp32dev">ESP32 DevKit</option>
                    <option value="node32s">NodeMCU-32S</option>
                    <option value="esp32cam">ESP32-CAM</option>
                </select>
                <select id="languageSelect" class="select" onchange="changeLanguage(this.value)">
                    <option value="ru">Русский</option>
                    <option value="en">English</option>
                </select>
                <button class="btn btn-sm" onclick="clearWorkspace()">
                    <i class="fas fa-trash"></i> Очистить
                </button>
            </div>
            <div class="toolbar-group">
                <span class="toolbar-label"><i class="fas fa-palette"></i> Тема:</span>
                <select id="themeSelect" class="select" onchange="changeTheme(this.value)">
                    <option value="default">По умолчанию</option>
                    <option value="dark">Темная</option>
                    <option value="highcontrast">Высокая контрастность</option>
                </select>
                <button class="btn btn-sm" onclick="toggleFullscreen()">
                    <i class="fas fa-expand"></i> Полный экран
                </button>
            </div>
        </div>

        <!-- Основное содержимое -->
        <div class="main-content">
            <!-- Блоки и рабочая область -->
            <div class="workspace-section">
                <div class="section-header">
                    <h3><i class="fas fa-puzzle-piece"></i> Рабочая область Blockly</h3>
                    <div class="workspace-info">
                        <span id="blockCount">0 блоков</span>
                        <span id="workspaceStatus" class="status-idle">Готов</span>
                    </div>
                </div>
                <div id="blocklyDiv"></div>
            </div>

            <!-- Панель кода и информации -->
            <div class="panel-section">
                <!-- Вкладки -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('code')">
                        <i class="fas fa-code"></i> Код
                    </button>
                    <button class="tab-btn" onclick="showTab('console')">
                        <i class="fas fa-terminal"></i> Консоль
                    </button>
                    <button class="tab-btn" onclick="showTab('blocks')">
                        <i class="fas fa-cubes"></i> Библиотека блоков
                    </button>
                    <button class="tab-btn" onclick="showTab('info')">
                        <i class="fas fa-info-circle"></i> Информация
                    </button>
                </div>

                <!-- Содержимое вкладок -->
                <div class="tab-content active" id="code-tab">
                    <div class="code-header">
                        <h4><i class="fas fa-file-code"></i> Сгенерированный код</h4>
                        <button class="btn btn-sm" onclick="copyCode()">
                            <i class="fas fa-copy"></i> Копировать
                        </button>
                        <button class="btn btn-sm" onclick="downloadCode()">
                            <i class="fas fa-download"></i> Скачать
                        </button>
                    </div>
                    <div id="codeEditor"></div>
                </div>

                <div class="tab-content" id="console-tab">
                    <div class="console-header">
                        <h4><i class="fas fa-terminal"></i> Консоль вывода</h4>
                        <button class="btn btn-sm" onclick="clearConsole()">
                            <i class="fas fa-trash"></i> Очистить
                        </button>
                        <button class="btn btn-sm" onclick="exportConsole()">
                            <i class="fas fa-file-export"></i> Экспорт
                        </button>
                    </div>
                    <div id="consoleOutput"></div>
                    <div class="console-input">
                        <input type="text" id="consoleCommand" placeholder="Введите команду...">
                        <button onclick="sendCommand()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>

                <div class="tab-content" id="blocks-tab">
                    <h4><i class="fas fa-cubes"></i> Библиотека блоков ESP32</h4>
                    <div class="blocks-library">
                        <div class="block-category">
                            <h5><i class="fas fa-bolt"></i> GPIO</h5>
                            <div class="block-list">
                                <!-- Блоки будут добавлены динамически -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="info-tab">
                    <h4><i class="fas fa-info-circle"></i> Информация о системе</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <i class="fas fa-server"></i>
                            <div>
                                <strong>Backend API</strong>
                                <span id="apiStatus">Проверка...</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-cube"></i>
                            <div>
                                <strong>Blockly</strong>
                                <span>v12.3.1</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-microchip"></i>
                            <div>
                                <strong>Плата</strong>
                                <span id="selectedBoard">ESP32 DevKit</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-project-diagram"></i>
                            <div>
                                <strong>Проектов</strong>
                                <span id="projectsCount">Загрузка...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-start">
                        <h5><i class="fas fa-rocket"></i> Быстрый старт</h5>
                        <ol>
                            <li>Перетащите блоки из панели слева</li>
                            <li>Соедините блоки вместе</li>
                            <li>Нажмите "Генерировать код"</li>
                            <li>Компилируйте и загружайте на ESP32</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Футер -->
    <footer>
        <div class="footer-content">
            <p>
                <i class="fas fa-code"></i> ESP32 Blockly Programmer v2.0 | 
                <i class="fas fa-cube"></i> Blockly 12.3.1 | 
                <i class="fas fa-heart"></i> Сделано с любовью к ESP32
            </p>
            <p class="footer-links">
                <a href="#" onclick="showAbout()"><i class="fas fa-info-circle"></i> О программе</a> |
                <a href="#" onclick="showDocumentation()"><i class="fas fa-book"></i> Документация</a> |
                <a href="#" onclick="showExamples()"><i class="fas fa-graduation-cap"></i> Примеры</a>
            </p>
        </div>
    </footer>

    <!-- Модальные окна -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('saveModal')">&times;</span>
            <h3><i class="fas fa-save"></i> Сохранение проекта</h3>
            <input type="text" id="projectName" placeholder="Имя проекта">
            <textarea id="projectDescription" placeholder="Описание проекта"></textarea>
            <button class="btn btn-primary" onclick="saveProjectConfirm()">Сохранить</button>
        </div>
    </div>

    <div id="loadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loadModal')">&times;</span>
            <h3><i class="fas fa-folder-open"></i> Загрузка проекта</h3>
            <div id="projectsList"></div>
        </div>
    </div>

    <!-- Скрытые элементы -->
    <xml id="toolbox" style="display: none"></xml>

    <!-- Подключение скриптов -->
    <script src="app.js"></script>
    <script src="blockly_generators.js"></script>
    <script src="workspace_manager.js"></script>
</body>
</html>
